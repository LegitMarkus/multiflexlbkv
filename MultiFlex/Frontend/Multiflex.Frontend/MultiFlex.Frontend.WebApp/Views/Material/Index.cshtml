@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<div class="text-center">
    <h1>@ViewData["Title"]</h1>

    <center>
        <div class="w-75" id="table_div"></div>
        <button id="open-add-window" type="submit" class="btn btn-primary">Erstellen</button>
        <button id="open-delete-window" type="submit" class="btn btn-primary">Löschen</button>    
    </center>

    <div class="d-flex justify-content-center pt-3 pb-2">
    </div>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
        const { ipcRenderer } = require("electron");
        document.addEventListener('DOMContentLoaded', pageLoaded);

        ipcRenderer.on('getloadMaterialAndLieferanten-reply', (event, arg, arg2) => {
            let lieferant = JSON.parse(arg);
            let material = JSON.parse(arg2);
            //alert("geht");
            google.charts.load('current', {'packages':['table']});
            google.charts.setOnLoadCallback(drawTable);

            function drawTable() {
                var lieferanten = [];
                for (var j = 0; j < material.length; j++){
                    for (var i = 0; i < lieferant.length; i++){
                        for (var k = 0; k < lieferant[i]["waren_ids"].length; k++){
                            //for (var l = 0; l < lieferant[j]["material_ids"].length; k++){
                                if(material[j]["id"] == lieferant[i]["waren_ids"][k]){
                                    var data = [material[j]["name"], lieferant[i]["name"], lieferant[i]["weblink"], lieferant[i]["lieferzeit"]];
                                    lieferanten.push(data);
                                }
                            //}
                        }
                    }
                }
                //alert("geht");
                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Material');
                data.addColumn('string', 'Lieferant');
                data.addColumn('string', 'Weblink');
                data.addColumn('number', 'Lieferzeit');
                //alert("geht1.5");
                data.addRows(lieferanten);

                //data.addRows([
                //  ['Mike',  {v: 10000, f: '$10,000'}, 1],
                //  ['Jim',   {v:8000,   f: '$8,000'},  1],
                //  ['Alice', {v: 12500, f: '$12,500'}, 1],
                //  ['Bob',   {v: 7000,  f: '$7,000'},  1]
                //]);


                var table = new google.visualization.Table(document.getElementById('table_div'));

                table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
                //alert("geht2");
          }
      });

        function pageLoaded(){
            ipcRenderer.send('loadMaterialAndLieferanten');
        }
        document.getElementById("open-add-window").addEventListener("click", () => {
            ipcRenderer.send("open-add-window");
        });
        document.getElementById("open-delete-window").addEventListener("click", () => {
            ipcRenderer.send("open-add-window");
        });
    </script>

</div>
